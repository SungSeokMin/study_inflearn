import 'package:flutter_architecture/data/data_source/pixabay_api.dart';
import 'package:flutter_architecture/data/repository/photo_api_repository_impl.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:http/http.dart' as http;
import 'package:mockito/annotations.dart';
import 'package:mockito/mockito.dart';

import 'pixabay_api_test.mocks.dart';

@GenerateMocks([http.Client])
void main() {
  const baseUrl = PixabayApi.baseUrl;
  const key = PixabayApi.key;

  test(
    'Pixabay 데이터를 잘 가져와야 한다.',
    () async {
      final client = MockClient();
      final api = PhotoApiRepositoryImpl(PixabayApi(client));

      when(client.get(
        Uri.parse(
          '$baseUrl?key=$key&q=iphone&image_type=photo&pretty=true',
        ),
      )).thenAnswer((_) async => http.Response(faceJsonBody, 200));

      final result = await api.fetch('iphone');

      expect(result.length, 20);

      verify(client.get(
        Uri.parse(
          '$baseUrl?key=$key&q=iphone&image_type=photo&pretty=true',
        ),
      ));
    },
  );
}

String faceJsonBody = """
{"total":9400,"totalHits":500,"hits":[{"id":1122537,"pageURL":"https://pixabay.com/photos/apple-water-droplets-fruit-moist-1122537/","type":"photo","tags":"apple, water droplets, fruit","previewURL":"https://cdn.pixabay.com/photo/2016/01/05/13/58/apple-1122537_150.jpg","previewWidth":150,"previewHeight":95,"webformatURL":"https://pixabay.com/get/g6ed6368feefec144f6adff65353547b6a7b9559a3d54ef00bc39bf725cb04450060027c3c49b80352fea57e92eb6144a0d44f0576ebc1f458563b024c7724051_640.jpg","webformatWidth":640,"webformatHeight":409,"largeImageURL":"https://pixabay.com/get/g4d44e2059fcffa6b8ee7709d35c9232321db35fbc42bce20b07bb690700853532f5e7be8de44c25821afb972ec25d4356979df88f69f65053a3980cd63ed783b_1280.jpg","imageWidth":4752,"imageHeight":3044,"imageSize":5213632,"views":389283,"downloads":235511,"collections":1156,"likes":1259,"comments":199,"user_id":1445608,"user":"mploscar","userImageURL":"https://cdn.pixabay.com/user/2016/01/05/14-08-20-943_250x250.jpg"},{"id":256261,"pageURL":"https://pixabay.com/photos/apple-books-still-life-fruit-food-256261/","type":"photo","tags":"apple, books, still life","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/28/apple-256261_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g38de4ee5ef8507b78ed9b073a78f85509ff794353e3015ad45a87261ee17a4ef55c22f6f74d37a329ae0730b552f018e_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/g0d8ef5430c6f984ed017f148855188beecd3650664bc2ffe804966a54df84253d356d9e931debc209ab7a6b42de3b67ab35819891e5ef203146c8aac87b15060_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2987083,"views":588483,"downloads":326795,"collections":1019,"likes":1039,"comments":253,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":1868496,"pageURL":"https://pixabay.com/photos/apple-computer-desk-workspace-1868496/","type":"photo","tags":"apple, computer, desk","previewURL":"https://cdn.pixabay.com/photo/2016/11/29/08/41/apple-1868496_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g8b8de7bfe87f1011f5a78e90c755d1c379415458dcbbdf1c479e4aaea11229dda8e1583f1f8ed355a32da97b7901edceb5e1ed162f6f29c270d9be58428f7121_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g1b65c3fab16c1edf3e52e3b1d5e4b692331bec30685d128d6409e994087989efcbabf12667f118a06dfb277941798c70bdc5c56c894dd4b628141b48062358bd_1280.jpg","imageWidth":5184,"imageHeight":3456,"imageSize":2735519,"views":815714,"downloads":606401,"collections":1539,"likes":1177,"comments":292,"user_id":2286921,"user":"Pexels","userImageURL":"https://cdn.pixabay.com/user/2016/03/26/22-06-36-459_250x250.jpg"},{"id":1873078,"pageURL":"https://pixabay.com/photos/apples-orchard-apple-trees-1873078/","type":"photo","tags":"apples, orchard, apple trees","previewURL":"https://cdn.pixabay.com/photo/2016/11/30/15/23/apples-1873078_150.jpg","previewWidth":150,"previewHeight":95,"webformatURL":"https://pixabay.com/get/gaa31e2ae85b5f0f96e4e51dfd8e3dbebc3ee56bb6120622e013c26954f5efd99dd970e5d1f8b89ee51f784a8bf60fbddf5cba207f961cb1d6f1d95b3943c9615_640.jpg","webformatWidth":640,"webformatHeight":408,"largeImageURL":"https://pixabay.com/get/ge10fd6ec0cbf4b1af2e288854963a11e67c5ca7b2f6de628ffffedd4fdc1646ff4d63073eaf37c317097e3a108b78126333490e88dff440408f79ba3066dbc71_1280.jpg","imageWidth":3212,"imageHeight":2051,"imageSize":2581012,"views":539411,"downloads":331430,"collections":1274,"likes":1313,"comments":197,"user_id":3890388,"user":"lumix2004","userImageURL":""},{"id":634572,"pageURL":"https://pixabay.com/photos/apples-fruits-red-ripe-vitamins-634572/","type":"photo","tags":"apples, fruits, red","previewURL":"https://cdn.pixabay.com/photo/2015/02/13/00/43/apples-634572_150.jpg","previewWidth":100,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g893d33192c0e3e59f415e6ca199d867031ec6d2ed60d875c1cba1c46304d136348c1decdcd277c7685a606907c05a1e3_640.jpg","webformatWidth":427,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/g81e20b5fe7b5c6a4eb7f32fa873b1fd213ed67e7cc74e39d5a95de339df5e184009daa708d0fcb4ef4b02f8edd1df75ff9f0b8c28f121962428c879f624a00bd_1280.jpg","imageWidth":3345,"imageHeight":5017,"imageSize":811238,"views":563538,"downloads":345825,"collections":1392,"likes":2478,"comments":209,"user_id":752536,"user":"Desertrose7","userImageURL":"https://cdn.pixabay.com/user/2016/03/14/13-25-18-933_250x250.jpg"},{"id":2788599,"pageURL":"https://pixabay.com/photos/apples-red-apple-ripe-apple-orchard-2788599/","type":"photo","tags":"apples, red apple, ripe","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/21/apples-2788599_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gcdfd429d51e167ca5e62326e801d6cd1a24d1e70c01ec5b7c1fa4e8cf08d4231eb81db1c9e9d7e276f0921b8dfb4634a863f0a8a949e81a5caed820fa1bc2cac_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g95e8d144aef030a1ac5489b38da3f9cbd530e5fd86fbeb1fa6cc0c1d0fc7f313eccd5ab8b768bbda991ade65ef89efc44e447c3197c6c51414220ab715beaa39_1280.jpg","imageWidth":6000,"imageHeight":4000,"imageSize":3660484,"views":158790,"downloads":88750,"collections":582,"likes":641,"comments":74,"user_id":2364555,"user":"NoName_13","userImageURL":"https://cdn.pixabay.com/user/2022/12/12/07-40-59-226_250x250.jpg"},{"id":256263,"pageURL":"https://pixabay.com/photos/apple-books-classroom-red-apple-256263/","type":"photo","tags":"apple, books, classroom","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/28/apple-256263_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/ge6fd8ae98332109f5e83601ad36a5946285885ddf890db26dbd9b17dde3246a3642912d7400bbdd6ecd06379d6b0a41e_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/g122d16027f7cfa3876f9a03663289aea8f49adc3982f7a5a5a095b35759b7371eba6caf2d82bdf0b9f00fe58d28bf897ccd5fabb3764ba83e80ed56a797ed305_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2864273,"views":275663,"downloads":157124,"collections":619,"likes":553,"comments":109,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":2788662,"pageURL":"https://pixabay.com/photos/apple-red-hand-apple-plantation-2788662/","type":"photo","tags":"apple, red, hand","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/42/apple-2788662_150.jpg","previewWidth":150,"previewHeight":88,"webformatURL":"https://pixabay.com/get/g267a9c1f5ba23174cd73164c8772d8ef36ce5b6bb1761242c331d3e7927c2d9bd62c2b3f5d742cbb2d36e19bf5330e313e1b3f85ce3b66b22eb7e385b8e49ed7_640.jpg","webformatWidth":640,"webformatHeight":377,"largeImageURL":"https://pixabay.com/get/g2da21a913e3ffd9c25596bce487934f7865340b6a4e4b011dd78942c6f738f68e1bbc22a5a35c60cb63354148ff0ced10d4e2b99d859b8ad6140bdcf7101de67_1280.jpg","imageWidth":6000,"imageHeight":3539,"imageSize":2042422,"views":213123,"downloads":135595,"collections":623,"likes":652,"comments":95,"user_id":2364555,"user":"NoName_13","userImageURL":"https://cdn.pixabay.com/user/2022/12/12/07-40-59-226_250x250.jpg"},{"id":606761,"pageURL":"https://pixabay.com/photos/apple-imac-ipad-workplace-606761/","type":"photo","tags":"apple, imac, ipad","previewURL":"https://cdn.pixabay.com/photo/2015/01/21/14/14/apple-606761_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g1d5726929da1acadafd74f04348849a7a5335c2cfc774f261b7c4f3b86c5a0fb16fbd7864e67391b933d4425a70b50ff_640.jpg","webformatWidth":640,"webformatHeight":425,"largeImageURL":"https://pixabay.com/get/g06cef61aecac7f2c2ae55b5998de2e4950a2ac2f046145c35b48ea987364c6acb67b111972ddcfcc1934b67298232e9c9a9459ab98ae14a59c0822893c16effd_1280.jpg","imageWidth":4209,"imageHeight":2796,"imageSize":1649126,"views":478712,"downloads":275306,"collections":728,"likes":550,"comments":122,"user_id":663163,"user":"Firmbee","userImageURL":"https://cdn.pixabay.com/user/2020/11/25/09-38-28-431_250x250.png"},{"id":1368187,"pageURL":"https://pixabay.com/photos/apple-blossom-flowers-tree-1368187/","type":"photo","tags":"apple blossom, flowers, tree","previewURL":"https://cdn.pixabay.com/photo/2016/05/02/22/16/apple-blossom-1368187_150.jpg","previewWidth":150,"previewHeight":88,"webformatURL":"https://pixabay.com/get/gc420c6ee35bbd4ec7599bb32eb66321c7619c0aba5a7d91b572d5ca72c31d00199d3edda8d4e9dba77a81e8ebf1c970eeba06deb80c8e9b8171b2666a7aad34b_640.jpg","webformatWidth":640,"webformatHeight":379,"largeImageURL":"https://pixabay.com/get/g1e6fd9f12d88ac63a62e940533e5e25ea5e9fdbdd3091fad4a4090e89864114133bc11a81bfcc27199db8dfd1645f445dce2028bac1feab4e28ec9a3caf3f14c_1280.jpg","imageWidth":3966,"imageHeight":2352,"imageSize":860935,"views":290986,"downloads":185337,"collections":706,"likes":821,"comments":138,"user_id":2367988,"user":"kie-ker","userImageURL":""},{"id":2788651,"pageURL":"https://pixabay.com/photos/apples-apple-tree-fruits-orchard-2788651/","type":"photo","tags":"apples, apple tree, fruits","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/39/apples-2788651_150.jpg","previewWidth":150,"previewHeight":77,"webformatURL":"https://pixabay.com/get/g9ad83f037a695b58b9fed1d51cba1c8ea7ee060d296b2c4c182ef43733aeef1e5f7967f4384c6acfcc24ff290f383790120994fd960cd939290a97c4cbdf665e_640.jpg","webformatWidth":640,"webformatHeight":330,"largeImageURL":"https://pixabay.com/get/g1012354474420aac0910f93c1b790f2515d188e9d227e6598c9747bff8145d7f31d0bae00a0ce4438ed83d70edcefb0aba1750480ee76061c412a90349ef23f7_1280.jpg","imageWidth":6000,"imageHeight":3103,"imageSize":2518838,"views":90465,"downloads":58688,"collections":488,"likes":476,"comments":53,"user_id":2364555,"user":"NoName_13","userImageURL":"https://cdn.pixabay.com/user/2022/12/12/07-40-59-226_250x250.jpg"},{"id":8591539,"pageURL":"https://pixabay.com/photos/apple-fruit-wet-food-8591539/","type":"photo","tags":"apple, fruit, wet","previewURL":"https://cdn.pixabay.com/photo/2024/02/23/08/27/apple-8591539_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/g8aae39d735c0403ff743d61e92c825d8bd2e19e9a500c95d145d2736df94609b76cdbd613684d4a0bc0ad7c425e8581bac23cb56037027d9a7c475e248972e29_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/gc977958e01421279c2365050932842007e7be2cd3031525fd00da5c794d32f5c870a86da82620724a509f7f624ed70a1b3f7082a41350c71d3264f1d995b5e5e_1280.jpg","imageWidth":6002,"imageHeight":4000,"imageSize":1943929,"views":13709,"downloads":11323,"collections":63,"likes":173,"comments":27,"user_id":9285194,"user":"guvo59","userImageURL":"https://cdn.pixabay.com/user/2023/06/15/05-00-59-993_250x250.jpg"},{"id":2788616,"pageURL":"https://pixabay.com/photos/apple-red-red-apple-2788616/","type":"photo","tags":"apple, red, red apple","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/31/apple-2788616_150.jpg","previewWidth":150,"previewHeight":90,"webformatURL":"https://pixabay.com/get/g91183fb065096b202b63efc62ee74a2ccd0fc270a54380bb81a57cf5a81e81d4a5076d7f0f25e67e9b3a67a17eafcbb50ebf4f3ff84caee5e74592e70981f7a9_640.jpg","webformatWidth":640,"webformatHeight":384,"largeImageURL":"https://pixabay.com/get/gbf7d1689f32553bd04c82b31a339b45aeb8c0510b8bb137e09f58c04e76e2e4614f9a04091b05677455163ba2aaa310adbc9503a403986c68ad04bbf7b213f7e_1280.jpg","imageWidth":6000,"imageHeight":3601,"imageSize":2758033,"views":148677,"downloads":90808,"collections":435,"likes":508,"comments":41,"user_id":2364555,"user":"NoName_13","userImageURL":"https://cdn.pixabay.com/user/2022/12/12/07-40-59-226_250x250.jpg"},{"id":805124,"pageURL":"https://pixabay.com/photos/apples-basket-fruits-apple-basket-805124/","type":"photo","tags":"apples, basket, fruits","previewURL":"https://cdn.pixabay.com/photo/2015/06/10/19/56/apples-805124_150.jpg","previewWidth":150,"previewHeight":129,"webformatURL":"https://pixabay.com/get/g1448472226d1e55b1ff28d19567abeea2b61d2a1aab4c3a16d09d8e17c53baf894eaf3859d52ad897f5c19af391ee74b_640.jpg","webformatWidth":640,"webformatHeight":553,"largeImageURL":"https://pixabay.com/get/g72e7ff2b036d14010957c481e5f5bbbdced11facc31a8c094132f490ce3310c905705af70d5b14a57a3d55bc9abd68610761f27251c8156e990f2dafa351e300_1280.jpg","imageWidth":3101,"imageHeight":2683,"imageSize":998659,"views":183501,"downloads":114103,"collections":523,"likes":544,"comments":108,"user_id":1107275,"user":"Larisa-K","userImageURL":"https://cdn.pixabay.com/user/2015/06/13/06-38-56-116_250x250.jpg"},{"id":1872997,"pageURL":"https://pixabay.com/photos/apples-fruits-orchard-nature-trees-1872997/","type":"photo","tags":"apples, fruits, orchard","previewURL":"https://cdn.pixabay.com/photo/2016/11/30/15/00/apples-1872997_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g2d2b3c61b504f3f5ee17bd30c6c715b40f943481679cd800a9d0f72f19668abd57c0e484b6315321e28d550076c92a6a527e7a9f5e6edc635e85ecf12280750f_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g120eaed49934493cc5043278470d14ce8baedc5b1e444b4c07f8e3b6c8f575e23bb6d931614766bbda48de71a974edf6bb4b99fdcb9072d06622340b77cb4ed6_1280.jpg","imageWidth":3504,"imageHeight":2336,"imageSize":2019234,"views":241023,"downloads":155485,"collections":711,"likes":717,"comments":103,"user_id":3890388,"user":"lumix2004","userImageURL":""},{"id":1702316,"pageURL":"https://pixabay.com/photos/apple-red-fruit-red-chief-1702316/","type":"photo","tags":"apple, red, fruit","previewURL":"https://cdn.pixabay.com/photo/2016/09/29/08/33/apple-1702316_150.jpg","previewWidth":150,"previewHeight":116,"webformatURL":"https://pixabay.com/get/g727b87004a02144c37c02a5aa73c6a3b6bd2323b0c96b09142113b58c2c99f06ecb41d2143fd1cf2a4537777d036b719515bf039705311b7854256d2bcaf0a61_640.jpg","webformatWidth":640,"webformatHeight":495,"largeImageURL":"https://pixabay.com/get/gc2e5c5fa3987837e292ecd6d0b81225c533605cf0927058722caae01fd6bff95f456e260c7bc979dd17c1e5ef14d1d96a96a7b6e4631324123d8d2d65c97d87a_1280.jpg","imageWidth":4000,"imageHeight":3099,"imageSize":1930833,"views":166904,"downloads":111432,"collections":360,"likes":370,"comments":32,"user_id":2364555,"user":"NoName_13","userImageURL":"https://cdn.pixabay.com/user/2022/12/12/07-40-59-226_250x250.jpg"},{"id":2391,"pageURL":"https://pixabay.com/photos/apple-diet-female-food-fresh-2391/","type":"photo","tags":"apple, diet, female","previewURL":"https://cdn.pixabay.com/photo/2010/12/13/10/09/apple-2391_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g850e56539120515b1cf10a2f9c30dfd0b16164a7c2a92fd7e6d9aa2e2b09be5c4e72456b268a2e45e3c0375ca313dc62_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g619f46aad20bcba083e20f7ab965bccf121c8dbfe4e7a1849913c5f88b44d17016b5878ad7bee9edb5f959cfd8bed257_1280.jpg","imageWidth":4752,"imageHeight":3168,"imageSize":752002,"views":152399,"downloads":101871,"collections":391,"likes":302,"comments":41,"user_id":14,"user":"PublicDomainPictures","userImageURL":"https://cdn.pixabay.com/user/2012/03/08/00-13-48-597_250x250.jpg"},{"id":569153,"pageURL":"https://pixabay.com/photos/home-office-notebook-home-couch-569153/","type":"photo","tags":"home office, notebook, home","previewURL":"https://cdn.pixabay.com/photo/2014/12/15/14/05/home-office-569153_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g45045be54f8335c904dd6ce49a6e39cd589bc5727fc4a9a246b2425e186a067f69a463483400767a132b26c758b9de68_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g1b24ddfd2449ef476ffc553c8598d3f9a3d398829b93d952e624987274d4e2664047402653c69ae5101dd9dc3eddb27e370d8a3432b45170fadc78a2c4faf761_1280.jpg","imageWidth":5760,"imageHeight":3840,"imageSize":3991496,"views":368340,"downloads":209134,"collections":685,"likes":501,"comments":92,"user_id":364018,"user":"Life-Of-Pix","userImageURL":"https://cdn.pixabay.com/user/2014/08/21/23-01-42-554_250x250.jpg"},{"id":256268,"pageURL":"https://pixabay.com/photos/apple-red-delicious-fruit-vitamins-256268/","type":"photo","tags":"apple, red, delicious","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/30/apple-256268_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g0bd0f9fd3e8351b0779230612c9cccf8438ccb6434440de7b2ce32c1d2c31d2cf7fbabdb5039d157cb696e593c13e945_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/g1628be3d2465359f796c8cd8c08609aea00b7445c93f798c21ac665e8cfb0fe5b32faa9887e26db734b5411adbf98d4a3e62762ba8ddff28aec1bfed5a4997b8_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2942037,"views":97144,"downloads":50635,"collections":321,"likes":270,"comments":41,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":1776744,"pageURL":"https://pixabay.com/photos/apples-leaves-fall-still-life-1776744/","type":"photo","tags":"apples, leaves, fall","previewURL":"https://cdn.pixabay.com/photo/2016/10/27/22/52/apples-1776744_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/g5575475e044eb0222b9209e56ab7c421719f6060a597ba3b3fa193faaec957ff665e57643c257f3b51d4854a8e8e62bc12fa4425a4ef8eadb560d5a04457cc45_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/g47685f186c60afd8ba9201ab7e7d3ba588ebcc31d8c5abeeef19fb06c666bd037eb584ee9832be31cdcc66ea8812ef01afaf98d9d97f32ae28a8c9417c770eb1_1280.jpg","imageWidth":4193,"imageHeight":2798,"imageSize":2002268,"views":264910,"downloads":171687,"collections":808,"likes":756,"comments":106,"user_id":2970404,"user":"castleguard","userImageURL":"https://cdn.pixabay.com/user/2016/09/18/22-38-35-578_250x250.jpg"}]}
""";
